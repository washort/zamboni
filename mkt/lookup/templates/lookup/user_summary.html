{% extends 'lookup/base.html' %}

{% block breadcrumbs %}
{% endblock %}

{% block content %}
  {% include 'lookup/includes/user_search.html' %}

  <section class="island c">
    {{ user_header(account, _('Account Lookup results for'), is_admin) }}

    <section id="prose">
      <h2>{{ _('General') }}</h2>
      <dl>
        <dt>{{ _('Display Name') }}</dt>
        <dd>{{ account.name }}</dd>
        <dt>{{ _('Firefox Accounts Identifier') }}</dt>
        <dd>{{ account.fxa_uid }}</dd>
        <dt>{{ _('Email') }}</dt>
        <dd>{{ emaillink(account.email) }}</dd>
        <dt>{{ _('Registered') }}</dt>
        <dd>{{ account.created|babel_datetime }}</dd>
        <dt>UGC</dt>
        <dd>?</dd>
        <dt>{{ _('Groups') }}</dt>
        <dd class="group-memberships">
          <table>
        {% for group in account.groups.all() %}
          <tr class="remove-group">
            <td><a href="{{ url('lookup.group_summary', group_id=group.id) }}">{{ group }}</a></td>
            {% if action_allowed('Admin', '%') %}
              {% if not group.restricted %}
                <td><button data-api-url="{{ url('account-groups', pk=account.id) }}" data-api-method="DELETE" data-api-group="{{ group.pk }}" class="remove button">{{ _('-') }}</button></td>
              {% else %}
                <td><button class="button disabled">&nbsp;</button></td>
              {% endif %}
            {% endif %}
          </tr>
        {% endfor %}
        {% if action_allowed('Admin', '%') %}
          <tr class="remove-group-blank hidden">
            <td>$group_name</td>
            <td><button data-api-url="{{ url('account-groups', pk=account.id) }}" data-api-method="DELETE" data-api-group="$group_pk" class="remove button">-</button></td>
          </tr>
          <tr class="add-group">
            <td>{{ group_membership_formset.empty_form.group }}</td>
            <td><button data-api-url="{{ url('account-groups', pk=account.id) }}" data-api-method="POST" class="add button disabled">+</button></div></td>
          </tr>
        {% endif %}
          </table>
        </dd>
      </dl>
    </section>

    <section id="payment-info">
      <h2>{{ _('Payments') }}</h2>
      <dl>
        <dt>{{ _('Marketplace Credit') }}:</dt>
        <dd>TODO</dd>
        <dt>{{ _('Payments') }}:</dt>
        <dd>{{ _('apps purchased') }}: {{ app_summary['app_total'] }}
                            {{ app_summary['app_amount']|format_currencies }}</dd>
        <dt>{{ _('Refunds') }}:</dt>
        <dd>{{ refund_summary['requested'] }} {{ _('requested' ) }}</dd>
        <dd>{{ refund_summary['approved'] }} {{ _('auto-approved') }}</dd>
        {% include 'lookup/includes/provider_portals.html' %}
      </dl>
    </section>

    <section id="developer-info">
      <h2>{{ _('Developer Program') }}</h2>
      <dl>
        <dt>{{ _('Read agreement') }}:</dt>
        <dd>
          {% if account.read_dev_agreement %}
            {{ account.read_dev_agreement|datetime }}
          {% else %}
            {{ _('No') }}
          {% endif %}
        </dd>
        <dt>{{ _('Addresses') }}:</dt>
        <dd>
          <div class="info-box">
          {% for pd in payment_data %}
            <p>{{ pd.full_name }}</p>
            {% if pd.business_name %}
              <p>{{ pd.business_name }}</p>
            {% endif %}
            <p>{{ pd.address_one }}</p>
            {% if pd.address_two %}
              <p>{{ pd.address_two }}</p>
            {% endif %}
            <p>{{ pd.city }}, {{ pd.state }} {{ pd.post_code }}</p>
            <p>{{ pd.country }}</p>
          {% else %}
            {{ _('None') }}
          {% endfor %}
          </div>
        </dd>
        <dt>{{ _('Submissions') }}:</dt>
        <dd class="product-lookup-list">
          {% for webapp in user_webapps %}
            <div>
              <a href="{{ webapp.get_url_path() }}">
                {% if webapp.name %}
                  {{ webapp.name }}
                {% else %}
                  {{ _('Unnamed') }}
                {% endif %}
              </a>
            </div>
          {% endfor %}
        </dd>
      </dl>
      {{ user_webapps|impala_paginator }}
    </section>

    <section id="delete-user">
      <h2>{{ _('Delete User') }}</h2>
      {% if not account.deleted %}
        <p>
          {% trans %}
            Deleting this user will <strong>permanently</strong> delete this
            user's account.
          {% endtrans %}
        </p>
        <button class="open-delete-modal manage">{{ _('Delete User') }}</button>
        <div class="modal modal-delete modal-hidden">
          <form method="post" action="{{ url('lookup.user_delete', account.id) }}">
            {{ csrf() }}
            <h3>{{ _('Delete User') }}</h3>
            <p class="warning">{{ _('Are you sure you wish to delete this user?') }}</p>
            <p>{{ delete_form }}</p>
            <p class="listing-footer c">
              <button class="bad delete-button" type="submit">{{ _('Delete User') }}</button>
              <a href="#" class="close cancel button">{{ _('Cancel') }}</a>
            </p>
          </form>
          <a class="close">{{ _('Cancel') }}</a>
        </div>
      {% else %}
        <p class="error">{{ _('This user has already been deleted.') }}</p>
        <dl>
          <dt>{{ _('Deleted by') }}</dt>
          <dd>{{ emaillink(delete_log.user.email, delete_log.user.name) }}</dd>
          {% if delete_log.details.reason %}
            <dt>{{ _('Reason') }}</dt>
            <dd>{{ delete_log.details.reason }}</dd>
          {% endif %}
        </dl>
      {% endif %}
    </section>

  </section>
{% endblock %}
